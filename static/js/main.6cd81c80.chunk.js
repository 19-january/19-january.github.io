(this["webpackJsonpsmm-generator"]=this["webpackJsonpsmm-generator"]||[]).push([[0],{107:function(e,t,a){e.exports=a(184)},184:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(32),i=a.n(c),o=a(20),u=a(24),s=a(33),l=a(38),d=a(17),h=a.n(d),f=a(26),g=a(46),m=a(202),p=a(201),v=a(102),b=a.n(v),k=a(200),w=a(203),E=a(103),y=a.n(E),j=a(64),O=a(50),S=a(98),_=a.n(S),x=a(76),R=function(e){var t=_()(e.src,"Anonymous"),a=Object(j.a)(t,1)[0],c=Object(n.useRef)();return Object(n.useEffect)((function(){a&&(c.current.cache(),c.current.getLayer().batchDraw())}),[a]),r.a.createElement(x.Image,Object.assign({ref:c,image:a},e))},I=a(99),C=a.n(I)()({preview:{position:"relative",padding:"1rem 0"}}),B=function(e){var t=e.width,a=void 0===t?1080:t,c=e.height,i=void 0===c?1080:c,o=e.padding,u=void 0===o?0:o,s=e.bottomImage,l=e.backgroundSrc,d=e.backgroundScale,h=e.logoWidth,f=e.logoHeight,g=e.canvasRef,m=C(e),p=Object(n.useRef)(null),v=Object(n.useState)(1),b=Object(j.a)(v,2),k=b[0],w=b[1];return Object(n.useEffect)((function(){var e=p.current;e&&w(e.offsetWidth/a)}),[a]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:p,className:m.preview},r.a.createElement(O.Stage,{width:a*k,height:i*k,scale:{x:k,y:k},ref:g},r.a.createElement(O.Layer,null,r.a.createElement(O.Rect,{width:a,height:i,fill:"#dfdfdf"}),r.a.createElement(R,{scaleX:d,scaleY:d,src:l}),r.a.createElement(R,{x:0,y:i-s.height,width:s.width,height:s.height,src:s.src})),r.a.createElement(O.Layer,null,r.a.createElement(R,{src:"/images/logo.png",width:h,height:f,y:9,x:u/2})))))},U=function(e){var t=e.backgroundSrc,a=e.backgroundScale,n=e.canvasRef;return r.a.createElement(B,{width:400,height:600,padding:70,logoWidth:90,logoHeight:138,backgroundSrc:t,backgroundScale:a,canvasRef:n,bottomImage:{width:400,height:425,src:"/images/vk-down.png"}})},L=a(100),W=a(101),A=a.n(W),P=function(){function e(t){Object(o.a)(this,e),this._auth=t,this._queue=new A.a({requestsPerSecond:2})}return Object(u.a)(e,[{key:"fetchAvatar",value:function(){var e=Object(f.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._call("users.get",{fields:"photo_400_orig"});case 2:return t=e.sent,e.abrupt("return",t.shift().photo_400_orig);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_call",value:function(){var e=Object(f.a)(h.a.mark((function e(t,a){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(L.a)({v:"5.126",count:100},a),e.next=3,this._auth.update();case 3:return e.abrupt("return",this._queue.add((function(){return new Promise((function(e,a){VK.Api.call(t,n,(function(t){t.response&&e(t.response),a(t)}))}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),D=a(104),M="connected",N=function(){function e(){Object(o.a)(this,e)}return Object(u.a)(e,[{key:"update",value:function(){var e=Object(f.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkSessionExpiration()){e.next=2;break}return e.abrupt("return",Promise.resolve(this._session));case 2:return e.next=4,this._getLoginStatus();case 4:if(t=e.sent,a=t.session,t.status!==M){e.next=10;break}return this._session=a,e.abrupt("return",Promise.resolve(a));case 10:return e.abrupt("return",this._login());case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){return this._session.user}},{key:"_login",value:function(){var e=this;return new Promise((function(t){VK.Auth.login((function(a){var n=a.session;if(a.status!==M)throw new T;e._session=n,t(n)}),1)}))}},{key:"_getLoginStatus",value:function(){return new Promise((function(e){return VK.Auth.getLoginStatus(e)}))}},{key:"_checkSessionExpiration",value:function(){var e=Math.round(Date.now()/1e3);return Boolean(this._session&&this._session.expire>e)}}]),e}(),T=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return a}(Object(D.a)(Error));function q(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=a,n.readAsDataURL(e)}))}var K=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).previewsMap={vk:U},n.vk=new P(new N),n.handleChange=function(e){return function(t){return n.setState(Object(g.a)({},e,t.target.value))}},n.handleSliderChange=function(e){return function(t,a){return n.setState(Object(g.a)({},e,a))}},n.onBackgroundUpload=Object(f.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(n.state.backgroundInputRef||{}).current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,q(t.files[0]);case 6:a=e.sent,n.setBackgroundUrl(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0444\u043e\u043d\u0430: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])}))),n.onSaveClick=function(){var e=(n.state.canvasRef||{}).current;e&&function(e,t){var a=document.createElement("a");a.download=t,a.href=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}(e.getStage().toDataURL({pixelRatio:2}),"19-\u044f\u043d\u0432\u0430\u0440\u044f")},n.onUploadBackgroundClick=function(){return n.state.backgroundInputRef&&n.state.backgroundInputRef.current.click()},n.state={imageType:"vk",backgroundImage:"",backgroundScale:1,canvasRef:r.a.createRef(),backgroundInputRef:r.a.createRef()},n}return Object(u.a)(a,[{key:"setBackgroundUrl",value:function(e){this.setState({backgroundImage:e,backgroundScale:1})}},{key:"render",value:function(){var e=this,t=this.previewsMap[this.state.imageType],a=Boolean(this.state.backgroundImage),n=Boolean(this.state.backgroundImage);return r.a.createElement("div",{className:"avatar-editor__content"},r.a.createElement("div",{className:"avatar-editor__form"},r.a.createElement(m.a,{margin:"normal",fullWidth:!0},r.a.createElement(p.a,{variant:"outlined",color:"default",fullWidth:!0,startIcon:r.a.createElement("img",{alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f vk",src:"/images/vk-logo.svg"}),onClick:Object(f.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,e.vk.fetchAvatar();case 3:return t.t1=t.sent,t.abrupt("return",t.t0.setBackgroundUrl.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))},"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440")),r.a.createElement(m.a,{fullWidth:!0},r.a.createElement("input",{accept:"image/*",type:"file",ref:this.state.backgroundInputRef,onChange:this.onBackgroundUpload,style:{display:"none"}}),r.a.createElement(p.a,{variant:"outlined",color:"default",fullWidth:!0,startIcon:r.a.createElement(b.a,null),onClick:this.onUploadBackgroundClick},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435")),a&&r.a.createElement(m.a,{variant:"outlined",margin:"normal",fullWidth:!0},r.a.createElement(k.a,{gutterBottom:!0},"\u041c\u0430\u0441\u0448\u0442\u0430\u0431 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f"),r.a.createElement(w.a,{min:0,max:3,step:.01,value:this.state.backgroundScale,onChange:this.handleSliderChange("backgroundScale")})),n&&r.a.createElement(m.a,{margin:"normal"},r.a.createElement(p.a,{variant:"contained",color:"primary",startIcon:r.a.createElement(y.a,null),onClick:this.onSaveClick},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"))),r.a.createElement("div",{className:"avatar-editor__preview"},r.a.createElement(t,{backgroundSrc:this.state.backgroundImage,backgroundScale:this.state.backgroundScale,canvasRef:this.state.canvasRef,imageType:this.state.imageType})))}}]),a}(r.a.Component),V=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement(K,null)}}]),a}(r.a.Component);i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(V,null)),document.getElementById("avatar-editor"))}},[[107,1,2]]]);
//# sourceMappingURL=main.6cd81c80.chunk.js.map